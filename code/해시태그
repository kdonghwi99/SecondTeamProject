<%@ page language="java" contentType="text/html; charset=EUC-KR" pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<style>
    /* Style for the hashtag list items */
    #tag-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex; /* Display items horizontally */
        flex-wrap: wrap; /* Allow hashtags to wrap to the next line */
    }

    .tag-item {
        margin: 5px 10px; /* Add some margin between hashtags */
        padding: 5px 10px;
        background-color: #e9e9e9;
        border-radius: 20px; /* Circular appearance */
        display: flex; /* Align content horizontally */
        align-items: center; /* Center content vertically */
    }

    .del-btn {
        cursor: pointer;
        margin-left: 5px;
    }
</style>
<meta charset="EUC-KR">
<title>Insert title here</title>
</head>
<body>
<div class="tr_hashTag_area">
    <p><strong>해시태그 구현</strong></p>
    <form id="tag-form" method="post" action="/submit_tags"> <!-- 서버로 제출할 경로를 action 속성에 지정하세요 -->
        <div class="form-group">
            <input type="hidden" value="" name="tag" id="rdTag" />
        </div>
    
        <ul id="tag-list"></ul>
                    
        <div class="form-group">
            <input type="text" id="tag" size="7" placeholder="엔터로 해시태그를 등록해주세요." style="width: 300px;"/>
       </div>
    </form>
</div>
<script>
    $(document).ready(function () {
        var tag = {};
        var counter = 0;

        // 입력한 값을 태그로 생성한다.
        function addTag (value) {
            tag[counter] = value;
            counter++; // del-btn 의 고유 id 가 된다.
        }

        // tag 안에 있는 값을 array type 으로 만들어서 넘긴다.
        function marginTag () {
            return Object.values(tag).filter(function (word) {
                return word !== "";
            });
        }
    
        // 서버에 제공
        $("#tag-form").on("submit", function (e) {
            var value = marginTag(); // return array
            $("#rdTag").val(value); 

            // 서버로 태그 데이터를 전송하고 처리할 수 있는 방법을 여기에 추가하세요
            // 예를 들어, Ajax를 사용하여 비동기적으로 데이터를 서버로 전송할 수 있습니다.

            e.preventDefault(); // 폼 기본 제출 동작 방지
        });

        $("#tag").on("keypress", function (e) {
            var self = $(this);

            // 엔터 키 입력을 확인합니다 (키코드 13)
            if (e.key === "Enter") {
                var tagValue = self.val().trim(); // 값 가져오고 앞뒤 공백 제거

                // 해시태그 값이 비어있지 않으면
                if (tagValue !== "") {
                    var result = Object.values(tag).filter(function (word) {
                        return word === tagValue;
                    });

                    if (result.length === 0) {
                        $("#tag-list").append("<li class='tag-item'>" + tagValue + "<span class='del-btn' idx='" + counter + "'>x</span></li>");
                        addTag(tagValue);
                        self.val("");
                    } else {
                        alert("태그값이 중복됩니다.");
                    }
                }
                e.preventDefault(); // 엔터 키 동작 방지
            }

            // 스페이스바 키 동작 방지
            if (e.keyCode === 32) {
                e.preventDefault();
            }
        });

        // 삭제 버튼 
        // 인덱스 검사 후 삭제
        $(document).on("click", ".del-btn", function (e) {
            var index = $(this).attr("idx");
            tag[index] = "";
            $(this).parent().remove();
        });
    });
</script>
</body>
</html>
